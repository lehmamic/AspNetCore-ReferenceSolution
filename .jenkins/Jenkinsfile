// ------------------------------------------------------------------------------
// <auto-generated>
//
//     This code was generated.
//
//     - To turn off auto-generation set:
//
//         [JenkinsPipeline (AutoGenerate = false)]
//
//     - To trigger manual generation invoke:
//
//         nuke --generate-configuration Jenkins --host Jenkins
//
// </auto-generated>
// ------------------------------------------------------------------------------

pipeline {
  agent none
  triggers {
    pollSCM('* * * * *')
  }
  stages {
    stage('Checkout') {
      agent none
      steps {
        checkout scm
        stash name: 'source', includes: '**/*'
      }
    }
    stage('') {
      failFast true
      parallel {
        stage('BackendRestore') {
          agent {
            kubernetes {
              label 'dotnet'
              yamlFile '.jenkins/pod-template.yaml'
              defaultContainer 'dotnet'
            }
          }
          steps {
            unstash 'source'
            sh 'sh ./build.sh --target BackendRestore --skip'
          }
        }
        stage('FrontendInstall') {
          agent {
            node {
              label 'node'
            }
          }
          steps {
            unstash 'source'
            sh './build.cmd --target FrontendInstall --skip'
          }
        }
      }
    }
    stage('') {
      failFast true
      parallel {
        stage('BackendCompile') {
          agent {
            kubernetes {
              label 'dotnet'
              yamlFile '.jenkins/pod-template.yaml'
              defaultContainer 'dotnet'
            }
          }
          steps {
            unstash 'source'
            sh 'sh ./build.sh --target BackendCompile --skip'
            stash name: 'backendcompile_72D4280E', includes: '**/bin/**/*'
            stash name: 'backendcompile_FDC3C53E', includes: '**/obj/**/*'
          }
        }
        stage('FrontendBuild') {
          agent {
            node {
              label 'node'
            }
          }
          steps {
            unstash 'source'
            sh './build.cmd --target FrontendBuild --skip'
          }
        }
      }
    }
    stage('') {
      failFast true
      parallel {
        stage('BackendTest') {
          agent {
            kubernetes {
              label 'dotnet'
              yamlFile '.jenkins/pod-template.yaml'
              defaultContainer 'dotnet'
            }
          }
          steps {
            unstash 'source'
            unstash 'backendtest_72D4280E'
            unstash 'backendtest_FDC3C53E'
            sh 'sh ./build.sh --target BackendTest --skip'
          }
        }
        stage('FrontendTest') {
          agent {
            node {
              label 'node'
            }
          }
          steps {
            unstash 'source'
            sh './build.cmd --target FrontendTest --skip'
          }
        }
      }
    }
    stage('') {
      failFast true
      parallel {
        stage('BackendPublish') {
          agent {
            kubernetes {
              label 'dotnet'
              yamlFile '.jenkins/pod-template.yaml'
              defaultContainer 'dotnet'
            }
          }
          steps {
            unstash 'source'
            unstash 'backendpublish_72D4280E'
            unstash 'backendpublish_FDC3C53E'
            sh 'sh ./build.sh --target BackendPublish --skip'
          }
        }
        stage('FrontendPublish') {
          agent {
            node {
              label 'node'
            }
          }
          steps {
            unstash 'source'
            sh './build.cmd --target FrontendPublish --skip'
          }
        }
      }
    }
    stage('BuildDockerImage') {
      agent {
        node {
          label 'docker'
        }
      }
      steps {
        unstash 'source'
        sh 'sh ./build.sh --target BuildDockerImage --skip'
      }
    }
  }
}
